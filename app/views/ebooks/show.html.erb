<h1><%= @ebook.title %></h1>

<% if @ebook.cover_image.attached? %>
  <%= image_tag @ebook.cover_image, width: 200 %>
<% end %>

<p><strong>Description:</strong> <%= @ebook.description %></p>
<p><strong>Price:</strong> $<%= @ebook.price %></p>
<p><strong>Status:</strong> <%= @ebook.status %></p>
<p><strong>Seller:</strong> <%= @ebook.user.name %></p>
<p><strong>Page Visits:</strong> <%= @ebook.page_visit_count %></p>
<p><strong>Preview Views:</strong> <%= @ebook.preview_view_count %></p>
<p><strong>Purchases:</strong> <%= @ebook.purchase_count %></p>

<% if @ebook.preview_pdf.attached? %>
  <%= link_to "Download Preview PDF", download_preview_ebook_path(@ebook) %>
<% end %>

<% if @ebook.live? %>
  <hr>
  <h3>Purchase this Ebook</h3>
  <p>Select a buyer:</p>
  <%= form_with url: purchases_path, method: :post do |f| %>
    <%= f.hidden_field :ebook_id, value: @ebook.id %>
    <p>
      <%= f.label :buyer_id, "Buy as:" %>
      <%= f.select :buyer_id, User.where(role: "buyer").map { |u| ["#{u.name} (Balance: $#{u.balance})", u.id] }, prompt: "Select a buyer" %>
    </p>
    <%= f.submit "Buy Now â€” $#{@ebook.price}" %>
  <% end %>
<% end %>

<% unless @ebook.live? %>
  <%= button_to "Advance Status", advance_status_ebook_path(@ebook), method: :patch %>
<% end %>

<%= link_to "Edit", edit_ebook_path(@ebook) %>
<%= link_to "Back", ebooks_path %>